{% extends "base.html" %}
{% load static %}
{% block title %}Recipe Details | Plateful{% endblock %}
{% block content %}
<a href="#main-content" class="skip-link">Skip to main content</a>
<div class="scroll-progress" role="progressbar" aria-label="Reading progress"></div>
<div class="page-loader" role="alert" aria-busy="true">
    <div class="loading-spinner" aria-hidden="true"></div>
    <span class="sr-only">Loading recipe...</span>
</div>
<main id="main-content" tabindex="-1" class="recipe-details-main">
    <div class="recipe-details-container" id="recipe-details-container" role="main" aria-live="polite">
        <!-- Dynamic content will be rendered here by recipe-details.js -->
    </div>
</main>
<script type="application/json" id="django-recipe-id">{{ recipe_id|default:"" }}</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("recipe-details-container");
        let recipeId = document.getElementById('django-recipe-id').textContent.trim();
        if (!recipeId) {
            const params = new URLSearchParams(window.location.search);
            recipeId = params.get("id");
        }
        if (!recipeId) {
            container.innerHTML = '<div class="recipe-error"><h2>Recipe Not Found</h2><p>No recipe ID provided.</p></div>';
            return;
        }
        container.innerHTML = `
            <div class="recipe-loading" role="alert" aria-busy="true">
                <div class="recipe-skeleton" aria-hidden="true">
                    <div class="skeleton-title"></div>
                    <div class="skeleton-meta"></div>
                    <div class="skeleton-description"></div>
                </div>
                <div class="sr-only">Loading recipe details, please wait...</div>
            </div>
        `;
        fetch(`/api/recipe/${recipeId}/`)
            .then(response => {
                if (!response.ok) throw new Error('Recipe not found');
                return response.json();
            })
            .then(recipe => {
                renderRecipe(recipe);
            })
            .catch(() => {
                container.innerHTML = `
                    <div class="recipe-error">
                        <h2>Recipe Not Found</h2>
                        <p>We couldn't find the recipe you're looking for.</p>
                        <a href="{% url 'recipes' %}" class="back-link">‚Üê Back to Recipes</a>
                    </div>
                `;
            });

        function renderRecipe(recipe) {
            const html = `
                <div class="recipe-text">
                    <h1>${recipe.name || recipe.title}</h1>
                    <p class="recipe-course"><strong>Course:</strong> ${recipe.course || 'Not specified'}</p>
                    <p class="recipe-description">${recipe.description || 'No description available.'}</p>
                    <h2>Ingredients</h2>
                    <ul>
                        ${(recipe.ingredients || []).map(ingredient => `<li>${ingredient}</li>`).join('')}
                    </ul>
                </div>
                <div class="recipe-image">
                    <img src="${recipe.image || '/static/images/placeholder.jpg'}" alt="${recipe.name || recipe.title}">
                </div>
            `;
            container.innerHTML = html;
        }
    });
</script>
<style>
    .recipe-details-main {
        margin-top: 4rem; /* Space for the navbar */
        padding: 20px;
        background-color: var(--background-light);
        min-height: calc(100vh - 4rem - 4rem); /* Adjust for navbar and footer */
    }

    .recipe-details-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: var(--background-light);
        box-shadow: 0 4px 8px var(--shadow-color);
        border-radius: 8px;
    }

    .recipe-text {
        flex: 1;
        font-size: 0.9rem;
        color: var(--text-dark);
    }

    .recipe-text h1 {
        font-size: 2rem;
        margin-bottom: 10px;
        color: var(--primary-color);
    }

    .recipe-text .recipe-description {
        margin-bottom: 20px;
        font-size: 1rem;
        line-height: 1.5;
    }

    .recipe-text h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: var(--primary-color);
    }

    .recipe-text ul {
        list-style: disc;
        padding-left: 20px;
    }

    .recipe-text li {
        margin-bottom: 5px;
    }

    .recipe-image {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .recipe-image img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        box-shadow: 0 4px 8px var(--shadow-color);
    }

    @media (max-width: 768px) {
        .recipe-details-container {
            flex-direction: column;
            align-items: center;
        }

        .recipe-image {
            margin-top: 20px;
        }
    }
</style>
{% endblock %}